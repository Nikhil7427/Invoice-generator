<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Bill Generator</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #eef1f5;
            padding: 30px;
        }

        .container {
            max-width: 900px;
            margin: auto;
            background: #ffffff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            border: 1px solid #ddd;
        }

        h2 {
            text-align: center;
            margin-bottom: 5px;
            letter-spacing: 1px;
        }

        h3 {
            text-align: center;
            margin-top: 0;
            color: #555;
        }

        .row {
            display: flex;
            gap: 20px;
            margin: 18px 0;
        }

        .row>div {
            flex: 1;
        }

        label {
            font-size: 13px;
            color: #374151;
            margin-bottom: 4px;
            display: block;
            font-weight: 500;
        }

        input {
            padding: 10px 12px;
            width: 100%;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            background: #f9fafb;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        input:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.15);
            background: #ffffff;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th {
            background: #f3f4f6;
            padding: 10px;
            border: 1px solid #ccc;
            font-weight: 600;
        }

        td {
            border: 1px solid #ccc;
            padding: 6px;
            text-align: center;
        }

        td input {
            border: none;
            width: 100%;
            padding: 8px 6px;
            font-size: 14px;
            background: transparent;
            text-align: center;
        }

        td input:focus {
            outline: none;
            background: #eef2ff;
        }

        .right {
            text-align: right;
            font-weight: 500;
        }

        button {
            padding: 6px 12px;
            margin-top: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }

        .add-btn {
            background: #6b7280;
            color: white;
        }

        .print-btn {
            background: #2563eb;
            color: white;
            margin-top: 20px;
        }

        .delete-btn {
            background: #ef4444;
            color: white;
        }

        .signature {
            margin-top: 50px;
            font-weight: 500;
            text-align: right;
        }

        @media print {
            button {
                display: none !important;
            }

            body {
                background: white;
                padding: 0;
            }

            input {
                border: none;
                background: transparent;
                box-shadow: none;
            }

            .container {
                box-shadow: none;
                border: none;
            }

            th:last-child,
            td:last-child {
                display: none !important;
            }

            button {
                display: none !important;
            }

            #amountWords {
                width: 100% !important;
                display: block;
            }

            #gstBreakup {
                margin-top: 10px;
                padding-left: 0;
                display: block;
                font-weight: 500;
            }

            .amount-gst-row {
                display: block !important;
            }

            .amount-gst-row>div {
                width: 100% !important;
                margin-bottom: 10px;
            }

            #gstBreakup {
                margin-top: 5px;
                padding-left: 0;
            }

            select {
                display: none !important;
            }

            .invoice-type-row {
                display: none !important;
            }

            /* Billed To & Mobile wrapping */
            #customer,
            #mobile {
                white-space: normal !important;
                word-wrap: break-word !important;
                word-break: break-word !important;
                height: auto !important;
            }

            /* Item description column wrapping */
            #itemTable td:first-child,
            #itemTable td:first-child input {
                white-space: normal !important;
                word-wrap: break-word !important;
                word-break: break-word !important;
                text-align: left !important;
            }

            /* Increase row height dynamically */
            #itemTable td {
                height: auto !important;
                vertical-align: top !important;
            }

            /* ‚úÖ FORCE TEXT WRAP EVERYWHERE */
            td,
            th {
                white-space: normal !important;
                word-break: break-word !important;
            }

            /* ‚úÖ TEXTAREA PRINT FIX */
            textarea {
                white-space: pre-wrap !important;
                word-break: break-word !important;
                overflow: visible !important;
                height: auto !important;
            }

            /* ‚úÖ TABLE CELL HEIGHT AUTO */
            td {
                height: auto !important;
                vertical-align: top !important;
            }

            td {
                height: auto !important;
                vertical-align: top !important;
            }

            textarea {
                overflow: visible !important;
                height: auto !important;
            }

            table {
                table-layout: auto !important;
            }

            tr {
                page-break-inside: avoid !important;
                break-inside: avoid !important;
            }

            tbody {
                page-break-inside: avoid !important;
            }

            textarea {
                overflow: visible !important;
                height: auto !important;
                min-height: unset !important;
            }

            /* Repeat header on each page */
            thead {
                display: table-header-group;
            }

            tbody {
                display: table-row-group;
            }

            /* Prevent row cutting */
            tr {
                break-inside: avoid !important;
                page-break-inside: avoid !important;
            }

            td {
                height: auto !important;
                vertical-align: top !important;
            }

            textarea {
                height: auto !important;
                overflow: visible !important;
                white-space: pre-wrap !important;
                word-break: break-word !important;
            }

            table {
                table-layout: auto !important;
            }
        }

        .item-text {
            width: 100%;
            border: none;
            resize: none;
            background: transparent;
            font-size: 14px;
            text-align: left;
            overflow: hidden;
            white-space: pre-wrap;
            word-break: break-word;
        }


        .footer {
            text-align: center;
            margin-top: 30px;
            font-style: italic;
            color: gray;
            font-size: 12px;
        }

        .print-text {
            white-space: pre-wrap;
            word-break: break-word;
            font-size: 14px;
        }
    </style>
</head>

<body>

    <div class="container" id="bill">
        <div style="border-bottom:3px solid #2563eb; padding-bottom:15px; margin-bottom:20px;">
            <h2 style="color:#1f2937;">CK ELECTRICALS</h2>
            <h3 id="invoiceTitle" style="color:#2563eb; font-weight:500;">
                Proforma Invoice
            </h3>
            <div style="text-align:center; font-size:13px; color:#4b5563; margin-top:8px;">
                Phulpur, Prayagraj, Uttar Pradesh<br>
                üìû +91 9415920769 &nbsp; | &nbsp; ‚úâÔ∏è Chandra15274@gmail.com
            </div>
        </div>

        <div class="row">
            <div>
                <label>Bill No</label>
                <input type="text" id="billNo" placeholder="Invoice No">
            </div>
            <div>
                <label>Date</label>
                <input type="date" id="billDate" value="">
            </div>
        </div>
        <div class="row invoice-type-row">
            <div>
                <label>Invoice Type</label>
                <select id="invoiceType" onchange="changeInvoiceType()" style="
            padding:10px;
            width:100%;
            border-radius:6px;
            border:1px solid #d1d5db;
            font-size:14px;
        ">
                    <option value="proforma">Proforma Invoice</option>
                    <option value="tax">Tax Invoice</option>
                    <option value="quotation">Quotation</option>
                </select>
            </div>
        </div>


        <div class="row">
            <div>
                <label>Billed To</label>
                <!-- <input type="text" id="customer" placeholder="Customer Name"> -->
                <textarea id="customer" rows="1" oninput="autoGrow(this)" placeholder="Customer Name" style="
                    width:100%;
                    border:1px solid #d1d5db;
                    border-radius:6px;
                    resize:none;
                    font-size:14px;
                "></textarea>
            </div>
            <div>
                <label>Mobile</label>
                <input type="text" id="mobile" placeholder="Mobile Number">
            </div>
        </div>

        <table id="itemTable">
            <thead>
                <tr>
                    <th>Item</th>
                    <th>Qty</th>
                    <th>Rate</th>
                    <th>Discount %</th>
                    <th>Total</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="itemBody">
                <tr>
                    <td>
                        <textarea rows="1" oninput="autoGrow(this); calc()" class="item-text"></textarea>
                    </td>
                    <td><input type="number" oninput="calc()"></td>
                    <td><input type="number" oninput="calc()"></td>
                    <td><input type="number" value="0" oninput="calc()"></td>
                    <td class="right">0</td>
                    <td>
                        <button class="delete-btn" onclick="deleteRow(this)">Delete</button>
                    </td>
                </tr>
            </tbody>
        </table>

        <button class="add-btn" onclick="addRow()">Add Item</button>

        <div class="row" style="margin-top: 20px;">
            <div>
                <label>GST %:</label>
                <input type="number" id="gstRate" value="18" oninput="calc()">
            </div>
        </div>

        <h3 class="right">Subtotal (after item discount): ‚Çπ <span id="subTotal">0</span></h3>
        <h3 class="right">
            Round Off: ‚Çπ <span id="roundOff">0.00</span>
        </h3>
        <h3 class="right">Grand Total (incl. GST): ‚Çπ <span id="grandTotal">0</span></h3>

        <div class="row amount-gst-row">
            <div>
                <label>Amount in Words:</label>
                <input type="text" id="amountWords" readonly>
            </div>
            <div>
                <label>GST Breakup:</label>
                <!-- <input type="text" id="gstBreakup" readonly> -->
                <div id="gstBreakup" style="font-size:14px;"></div>
            </div>
        </div>

        <div class="signature">
            Authorized Signature
        </div>

        <div class="footer" id="invoiceFooter">
            This is a computer-generated proforma invoice
        </div>


        <button class="print-btn" onclick="window.print()">Print / Save PDF</button>
    </div>

    <script>
        function autoGrow(el) {
            el.style.height = "auto";
            el.style.height = (el.scrollHeight) + "px";
        }

        // ===== Invoice Type Toggle =====
        function changeInvoiceType() {
            const type = document.getElementById("invoiceType").value;
            const title = document.getElementById("invoiceTitle");
            const footer = document.getElementById("invoiceFooter");

            if (type === "tax") {
                title.innerText = "Tax Invoice";
                footer.innerText = "This is a computer-generated tax invoice";
            } else if (type === "proforma") {
                title.innerText = "Proforma Invoice";
                footer.innerText = "This is a computer-generated proforma invoice";
            } else {
                title.innerText = "Quotation";
                footer.innerText = "This is a computer-generated Quotation";
            }
        }


        // ===== Auto Bill Number =====
        // let lastBillNumber = localStorage.getItem('lastBillNumber') || 0;
        // let newBillNumber = parseInt(lastBillNumber) + 1;
        // document.getElementById('billNo').value = newBillNumber;
        // localStorage.setItem('lastBillNumber', newBillNumber);

        // ===== Set today's date =====
        document.getElementById('billDate').valueAsDate = new Date();

        // ===== Add Item Row =====
        function addRow() {
            let tbody = document.getElementById("itemBody");

            let row = tbody.insertRow();

            row.insertCell(0).innerHTML =
                `<textarea rows="1" oninput="autoGrow(this); calc()" class="item-text"></textarea>`;

            row.insertCell(1).innerHTML =
                `<input type="number" oninput="calc()">`;

            row.insertCell(2).innerHTML =
                `<input type="number" oninput="calc()">`;

            row.insertCell(3).innerHTML =
                `<input type="number" value="0" oninput="calc()">`;

            row.insertCell(4).className = "right";
            row.cells[4].innerText = "0";

            row.insertCell(5).innerHTML =
                `<button class="delete-btn" onclick="deleteRow(this)">Delete</button>`;
        }


        // ===== Delete Item Row =====
        function deleteRow(btn) {
            let row = btn.parentNode.parentNode;
            row.parentNode.removeChild(row);
            calc(); // recalculate totals
        }

        // ===== Calculate Totals, GST & Amount in Words =====
        function calc() {
            let subtotal = 0;
            let rows = document.querySelectorAll("#itemBody tr");

            rows.forEach(row => {
                let qty = parseFloat(row.cells[1].querySelector("input").value) || 0;
                let rate = parseFloat(row.cells[2].querySelector("input").value) || 0;
                let discount = parseFloat(row.cells[3].querySelector("input").value) || 0;

                let total = qty * rate;
                let discountedTotal = total - (total * discount / 100);
                row.cells[4].innerText = discountedTotal.toFixed(2);
                subtotal += discountedTotal;
            });

            document.getElementById("subTotal").innerText = subtotal.toFixed(2);

            let gstRate = parseFloat(document.getElementById("gstRate").value) || 0;
            let cgst = (subtotal * gstRate / 2 / 100).toFixed(2);
            let sgst = (subtotal * gstRate / 2 / 100).toFixed(2);
            document.getElementById("gstBreakup").innerHTML =
                `CGST (${gstRate / 2}%): ‚Çπ${cgst}<br>SGST (${gstRate / 2}%): ‚Çπ${sgst}`;

            let exactTotal = subtotal + parseFloat(cgst) + parseFloat(sgst);
            let roundedTotal = Math.ceil(exactTotal);
            let roundOff = roundedTotal - exactTotal;

            document.getElementById("grandTotal").innerText = roundedTotal.toFixed(2);
            document.getElementById("roundOff").innerText = roundOff.toFixed(2);
            document.getElementById("amountWords").value =
                numberToWords(roundedTotal) + " Rupees Only";
        }


        // ===== Convert Number to Words =====
        function numberToWords(num) {
            const a = ['', 'One', 'Two', 'Three', 'Four', 'Five', 'Six', 'Seven', 'Eight', 'Nine', 'Ten', 'Eleven', 'Twelve', 'Thirteen', 'Fourteen', 'Fifteen', 'Sixteen', 'Seventeen', 'Eighteen', 'Nineteen'];
            const b = ['', '', 'Twenty', 'Thirty', 'Forty', 'Fifty', 'Sixty', 'Seventy', 'Eighty', 'Ninety'];

            if (num === 0) return 'Zero';

            function inWords(n) {
                if (n < 20) return a[n];
                if (n < 100) return b[Math.floor(n / 10)] + (n % 10 ? ' ' + a[n % 10] : '');
                if (n < 1000) return a[Math.floor(n / 100)] + ' Hundred' + (n % 100 ? ' ' + inWords(n % 100) : '');
                if (n < 100000) return inWords(Math.floor(n / 1000)) + ' Thousand' + (n % 1000 ? ' ' + inWords(n % 1000) : '');
                if (n < 10000000) return inWords(Math.floor(n / 100000)) + ' Lakh' + (n % 100000 ? ' ' + inWords(n % 100000) : '');
                return inWords(Math.floor(n / 10000000)) + ' Crore' + (n % 10000000 ? ' ' + inWords(n % 10000000) : '');
            }

            return inWords(num);
        }

        // ===== Initial Calculation =====
        calc();

        window.onload = () => {
            document.querySelectorAll("textarea").forEach(autoGrow);
        };

        function preparePrint() {
            document.querySelectorAll("textarea").forEach(t => {
                const div = document.createElement("div");
                div.className = "print-text";
                div.innerText = t.value;
                div.setAttribute("data-textarea", "true");
                t.style.display = "none";
                t.parentNode.appendChild(div);
            });
        }

        function restoreAfterPrint() {
            document.querySelectorAll("div[data-textarea]").forEach(div => {
                const textarea = div.parentNode.querySelector("textarea");
                if (textarea) textarea.style.display = "";
                div.remove();
            });
        }

        window.onbeforeprint = preparePrint;
        window.onafterprint = restoreAfterPrint;

    </script>

</body>

</html>